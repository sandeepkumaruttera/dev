 was recently asked in a DevOps interview:
 â€œHow would you prevent the creation of AWS resources unless they have a specific tag?â€

I knew how to write the IAM policy using aws:RequestTag
but I got stuck when they asked how to enforce it across multiple AWS accounts.

Hereâ€™s the IAM policy I wrote:

{
 "Version": "2012-10-17",
 "Statement": [
 {
 "Sid": "DenyCreateWithoutManagedByTag",
 "Effect": "Deny",
 "Action": "*",
 "Resource": "*",
 "Condition": {
 "StringNotEqualsIfExists": {
 "aws:RequestTag/ManagedBy": "Terraform"
 }
 }
 }
 ]
}

Hereâ€™s what I learned later:

Service Control Policies (SCPs) are what you'd use to enforce such tag-based restrictions across all accounts in an AWS Organization.

- IAM policies manage permissions within an account
- SCPs set guardrails across accounts, regardless of a userâ€™s permissions

So if you want to block untagged resource creation org-wide, attach an SCP at the OrgÂ orÂ OUÂ level.


---------------------------------------------------------------------------------------------------------------------------------

chatgpt answer
-----------------


â“ What are they asking?
They are asking:

"How can you make sure no one creates AWS resources (like EC2, S3, RDS) unless they add a specific tag?"

For example:
Only allow people to create an EC2 instance if they tag it with Environment=Production (or any required tag).

âœ… Why is this important?
Tags are used for:

Cost tracking

Ownership info

Automation

Security

If people forget to add tags, it's hard to manage resources. So companies want to enforce tagging rules.

ðŸ›  How do you enforce this in AWS?
There are two common ways to block resource creation if required tags are missing:

âœ… 1. Service Control Policies (SCPs) â€“ for AWS Organizations
SCPs are like "master rules" that apply to accounts or groups in an organization.

You can deny creating any resource if the required tag is missing.

ðŸ”¹ Example: Deny EC2 or S3 creation if Owner tag is missing.

json
Copy
Edit
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Deny",
      "Action": [
        "ec2:RunInstances",
        "s3:CreateBucket"
      ],
      "Resource": "*",
      "Condition": {
        "Null": {
          "aws:RequestTag/Owner": "true"
        }
      }
    }
  ]
}
This policy says:
âž¡ï¸ "If someone tries to create EC2 or S3 and doesnâ€™t include the Owner tag, then deny the request."

âœ… 2. IAM Policies with Conditions â€“ for specific users/roles
If you're not using AWS Organizations, you can add similar checks in IAM policies.

ðŸ”¹ Example: Allow EC2 creation only if Environment tag is present.

json
Copy
Edit
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Deny",
      "Action": "ec2:RunInstances",
      "Resource": "*",
      "Condition": {
        "Null": {
          "aws:RequestTag/Environment": "true"
        }
      }
    }
  ]
}
This means:
âž¡ï¸ "If the user doesnâ€™t include the Environment tag, deny EC2 creation."

ðŸ”’ So whatâ€™s the best answer?
"To prevent AWS resource creation without a specific tag, I would use Service Control Policies in AWS Organizations to deny actions like ec2:RunInstances or s3:CreateBucket unless a required tag (like Owner or Environment) is included. If SCPs arenâ€™t available, I would use IAM policies with condition checks on aws:RequestTag to enforce tagging at the user or role level."

Would you like me to show how to attach such a policy in the AWS Console or for a specific service?

You said:
show that once 
ChatGPT said:
Great! Here's a step-by-step guide on how to enforce a tag policy in AWS using IAM policy via the AWS Console. We'll block EC2 instance creation unless a specific tag (e.g., Environment) is provided.

ðŸ› ï¸ Use Case:
Block users from launching EC2 instances unless they include a tag Environment.

âœ… Step-by-Step: Enforce Tag Using IAM Policy
ðŸŒ€ Step 1: Go to the IAM Console
Open the AWS Console

Go to IAM > Policies

Click "Create Policy"

ðŸ“ Step 2: Use this JSON policy
Under the "JSON" tab, paste the following:

json
Copy
Edit
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "DenyEC2RunInstancesWithoutTag",
      "Effect": "Deny",
      "Action": "ec2:RunInstances",
      "Resource": "*",
      "Condition": {
        "Null": {
          "aws:RequestTag/Environment": "true"
        }
      }
    }
  ]
}
âž¡ï¸ This policy denies EC2 creation if the tag Environment is not included in the request.

âœ… Step 3: Name and Create the Policy
Click Next: Tags (you can skip this)

Click Next: Review

Name the policy something like: DenyEC2WithoutEnvironmentTag

Click Create Policy

ðŸ‘¥ Step 4: Attach the Policy to a User or Role
Go to IAM > Users or IAM > Roles

Choose the user/role

Go to the Permissions tab

Click Add permissions > Attach policies

Search for DenyEC2WithoutEnvironmentTag and attach it

ðŸš€ Step 5: Test It
Try launching an EC2 instance:

Without a tag â†’ It will be denied

With a tag like Environment=Production â†’ It will be allowed

ðŸ§ª Note: This works only if the user/role also has allow permissions to launch EC2. This policy only adds a "Deny if tag missing" condition.

âœ… BONUS: Use Tag Editor to Review Tags
You can go to:

AWS Console > Tag Editor

Search for untagged resources across your AWS environment.